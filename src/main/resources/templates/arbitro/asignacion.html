<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <title th:text="#{arbitro.asig.pageTitle}">Mis asignaciones</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Tus estilos -->
  <link rel="stylesheet" href="/css/globals.css">
  <link rel="stylesheet" href="/css/home.css">
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/footer.css">
</head>
<body>
  <!-- HEADER -->
  <div th:replace="fragments/header :: header"></div>

  <main class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="card p-4 shadow-sm rounded-3">
          <h2 class="mb-4 text-center" th:text="#{arbitro.asig.h1}">Mis Asignaciones</h2>

          <!-- Mensajes i18n por código -->
          <div th:if="${msgCode}" class="alert alert-success"
               th:text="${msgArg0 != null} ? ${#messages.msg(msgCode, msgArg0)} : ${#messages.msg(msgCode)}"></div>

          <div th:if="${errCode}" class="alert alert-danger"
              th:text="${errArg0 != null} ? ${#messages.msg(errCode, errArg0)} : ${#messages.msg(errCode)}"></div>


          <!-- Lista de asignaciones -->
          <div th:if="${asignaciones != null and !#lists.isEmpty(asignaciones)}" class="list-group">
            <div th:each="a : ${asignaciones}" class="asignacion-item list-group-item mb-3 shadow-sm rounded">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="mb-1">
                    <strong th:text="#{arbitro.asig.field.fecha}">Fecha:</strong>
                    <span th:text="${#temporals.format(a.fechaAsignacion, 'dd/MM/yyyy')}">22/08/2025</span>
                  </p>
                  <p class="mb-1">
                    <strong th:text="#{arbitro.asig.field.partido}">Partido:</strong>
                    <span th:text="${a.partido.equipoLocal + ' vs ' + a.partido.equipoVisitante}">A vs B</span>
                  </p>
                  <p class="mb-1">
                    <strong th:text="#{arbitro.asig.field.torneo}">Torneo:</strong>
                    <span th:text="${a.torneo != null ? a.torneo.nombre : '—'}">Nombre Torneo</span>
                  </p>
                  <p class="mb-1">
                    <strong th:text="#{arbitro.asig.field.estado}">Estado:</strong>
                    <span th:text="${a.estado}">PENDIENTE</span>
                  </p>
                  <p class="mb-0">
                    <strong th:text="#{arbitro.asig.field.monto}">Monto:</strong>
                    <span th:text="${a.monto != null ? '$ ' + #numbers.formatDecimal(a.monto,1,'POINT',2,'COMMA') : '—'}">$ 0,00</span>
                  </p>
                </div>

                <!-- Botones solo si está PENDIENTE -->
                <div th:if="${a.estado != null and a.estado.name() == 'PENDIENTE'}"
                     class="d-flex flex-column gap-2">
                  <form th:action="@{/arbitro/asignaciones/{id}/aceptar(id=${a.id})}" method="post">
                    <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn btn-caba-verde btn-sm" th:text="#{btn.aceptar}">Aceptar</button>
                  </form>
                  <form th:action="@{/arbitro/asignaciones/{id}/rechazar(id=${a.id})}" method="post">
                    <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn btn-caba-peligro btn-sm" th:text="#{btn.rechazar}">Rechazar</button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <!-- Vacío -->
          <p th:if="${asignaciones == null or #lists.isEmpty(asignaciones)}" class="text-center text-muted"
             th:text="#{arbitro.asig.empty}">
            Aún no tienes asignaciones.
          </p>
        </div>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <div th:replace="fragments/footer :: footer"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
