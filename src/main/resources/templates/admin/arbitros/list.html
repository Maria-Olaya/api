<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8" />
  <title th:text="#{admin.arbitros.titulo}"></title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="/css/globals.css">
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/home.css">
  <link rel="stylesheet" href="/css/footer.css">

  <!-- Iconos -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>

  <!-- Header -->
  <div th:replace="fragments/header :: header"></div>

  <main class="container my-5">
    <h1 class="fw-bold" th:text="#{admin.arbitros.titulo}"></h1>

    <!-- Panel central (asignaciones de árbitro seleccionado) -->
    <div th:if="${arbitroSel != null}" class="card p-3">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
          <strong th:text="${#messages.msg('admin.arbitros.asignacionesde') + ' ' + (arbitroSel.nombre ?: '') + ' ' + (arbitroSel.apellido ?: '')}"></strong>
          <span class="muted" th:text="${' (ID ' + arbitroSel.id + ')'}"></span>
        </div>

        <div>
          <a th:href="@{/admin/arbitros}" style="text-decoration:none;">
            <th th:text="#{admin.arbitros.cerrar}"></th>
          </a>
        </div>
      </div>

      <table class="table table-striped table-bordered mt-2">
        <thead class="table-light">
          <tr>
            <th th:text="#{admin.arbitros.partido}"></th>
            <th th:text="#{admin.arbitros.asignacion}"></th>
            <th th:text="#{admin.arbitros.estado}"></th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="as : ${asignacionesSel}">
            <td>
              <div>
                <span th:text="${#temporals.format(as.partido.fecha,'yyyy-MM-dd HH:mm')}"></span> —
                <span th:text="${as.partido.equipoLocal + ' vs ' + as.partido.equipoVisitante}"></span>
              </div>
              <div class="muted" th:if="${as.torneo != null}">
                <span th:text="#{admin.arbitros.torneo}"></span>
                <span th:text="${as.torneo.nombre}"></span>
              </div>
            </td>
            <td th:text="${as.fechaAsignacion}"></td>
            <td class="estado"
                th:classappend="${' ' + as.estado}"
                th:text="#{${'asignacion.estado.' + #strings.toLowerCase(as.estado)}}"></td>
          </tr>

          <tr th:if="${#lists.isEmpty(asignacionesSel)}">
            <td colspan="3" class="muted" th:text="#{admin.arbitros.noasignaciones}"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Tabla principal de árbitros -->
    <table class="table table-hover table-bordered mt-4">
      <thead class="table-dark">
        <tr>
          <th th:text="#{admin.arbitros.id}"></th>
          <th th:text="#{admin.arbitros.nombre}"></th>
          <th th:text="#{admin.arbitros.email}"></th>
          <th th:text="#{admin.arbitros.especialidad}"></th>
          <th th:text="#{admin.arbitros.escalafon}"></th>
          <th th:text="#{admin.arbitros.fechadisponible}"></th>
          <th th:text="#{admin.arbitros.acciones}"></th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="a : ${arbitros}">
          <td th:text="${a.id}"></td>
          <td th:text="${(a.nombre != null ? a.nombre : '') + ' ' + (a.apellido != null ? a.apellido : '')}"></td>
          <td th:text="${a.correo}"></td>

          <td th:text="#{${a.especialidad.messageKey}}"></td>
          <td th:text="#{${a.escalafon.messageKey}}"></td>

          <td>
            <span th:if="${a.fechasDisponibles == null or #lists.isEmpty(a.fechasDisponibles)}">—</span>
            <span th:if="${a.fechasDisponibles != null and !#lists.isEmpty(a.fechasDisponibles)}"
                  th:each="f, st : ${a.fechasDisponibles}"
                  th:text="${#temporals.format(f,'yyyy-MM-dd') + (st.last ? '' : ', ')}"></span>
          </td>

          <!-- Acciones -->
          <td class="text-center actions" style="display:flex; justify-content:center; gap:0.3rem; align-items:center;">
            <!-- Editar -->
            <a th:href="@{'/admin/arbitros/' + ${a.id} + '/editar'}"
               class="btn btn-sm btn-caba-naranja" title="Editar">
              <i class="bi bi-pencil-square"></i>
            </a>

            <!-- Eliminar -->
            <form th:action="@{'/admin/arbitros/' + ${a.id} + '/eliminar'}" method="post" style="display:inline;">
              <div th:if="${_csrf != null}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              </div>
              <button type="submit" class="btn btn-sm btn-caba-peligro"
                      th:onclick="'return confirm(\'' + #{admin.arbitros.confirmareliminar} + '\')'"
                      title="Eliminar">
                <i class="bi bi-trash"></i>
              </button>
            </form>

            <!-- Ver asignaciones -->
            <a th:href="@{'/admin/arbitros'(arbitroId=${a.id})}"
               class="btn btn-sm btn-caba-verde" title="Ver asignaciones">
              <i class="bi bi-person-lines-fill"></i>
            </a>
          </td>
        </tr>

        <tr th:if="${#lists.isEmpty(arbitros)}">
          <td colspan="7" th:text="#{admin.arbitros.noarbitros}"></td>
        </tr>
      </tbody>
    </table>
  </main>

  <!-- Footer -->
  <div th:replace="fragments/footer :: footer"></div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
