<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Gestión de Árbitros</title>


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  
  <link rel="stylesheet" href="/css/globals.css">
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/home.css">
  <link rel="stylesheet" href="/css/footer.css">

 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
 
  <div th:replace="fragments/header :: header"></div>

  <main class="container my-5">
    <h1 class="mb-4">Gestión de Árbitros</h1>


    <!-- Panel central-->
    <div th:if="${arbitroSel != null}" class="card">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
          <strong th:text="${'Asignaciones de: ' + (arbitroSel.nombre ?: '') + ' ' + (arbitroSel.apellido ?: '')}"></strong>
          <span class="muted" th:text="${' (ID ' + arbitroSel.id + ')'}"></span>
        </div>
        <div>
          <a th:href="@{/admin/arbitros}" style="text-decoration:none;">✖ Cerrar</a>
        </div>
      </div>

      <table class="table table-striped table-bordered mt-2">
        <thead class="table-light">
          <tr>
            <th>Partido</th>
            <th>Fecha asignación</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="as : ${asignacionesSel}">
            <td>
              <div>
                <span th:text="${#temporals.format(as.partido.fecha,'yyyy-MM-dd HH:mm')}"></span> —
                <span th:text="${as.partido.equipoLocal + ' vs ' + as.partido.equipoVisitante}"></span>
              </div>
              <div class="muted" th:if="${as.torneo != null}">
                Torneo: <span th:text="${as.torneo.nombre}"></span>
              </div>
            </td>
            <td th:text="${as.fechaAsignacion}"></td>
            <td class="estado" th:classappend="${' ' + as.estado}" th:text="${as.estado}"></td>
          </tr>

          <tr th:if="${#lists.isEmpty(asignacionesSel)}">
            <td colspan="3" class="muted">Este árbitro no tiene asignaciones.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Tabla de árbitros -->
    <table class="table table-hover table-bordered">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Correo</th>
          <th>Especialidad</th>
          <th>Escalafón</th>
          <th>Fechas disponibles</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="a : ${arbitros}">
          <td th:text="${a.id}"></td>
          <td th:text="${(a.nombre != null ? a.nombre : '') + ' ' + (a.apellido != null ? a.apellido : '')}"></td>
          <td th:text="${a.correo}"></td>
          <td th:text="${a.especialidad}"></td>
          <td th:text="${a.escalafon}"></td>
          <td>
            <span th:if="${a.fechasDisponibles == null or #lists.isEmpty(a.fechasDisponibles)}">—</span>
            <span th:if="${a.fechasDisponibles != null and !#lists.isEmpty(a.fechasDisponibles)}"
                  th:each="f, st : ${a.fechasDisponibles}"
                  th:text="${#temporals.format(f,'yyyy-MM-dd') + (st.last ? '' : ', ')}"></span>
          </td>
          <td class="text-center actions" style="display:flex; justify-content:center; gap:0.3rem; align-items:center;">

              <!-- Editar -->
              <a th:href="@{'/admin/arbitros/' + ${a.id} + '/editar'}"
                class="btn btn-sm btn-caba-naranja" title="Editar">
                <i class="bi bi-pencil-square"></i>
              </a>

              <!-- Eliminar -->
              <form th:action="@{'/admin/arbitros/' + ${a.id} + '/eliminar'}" method="post" style="display:inline;">
                  <div th:if="${_csrf != null}">
                      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                  </div>
                  <button type="submit" class="btn btn-sm btn-caba-peligro" 
                          onclick="return confirm('¿Eliminar árbitro?')" title="Eliminar">
                      <i class="bi bi-trash"></i>
                  </button>
              </form>

              <!-- Ver asignaciones -->
              <a th:href="@{'/admin/arbitros'(arbitroId=${a.id})}"
                class="btn btn-sm btn-caba-verde" title="Ver asignaciones">
                <i class="bi bi-person-lines-fill"></i>
              </a>

          </td>


        </tr>

        <tr th:if="${#lists.isEmpty(arbitros)}">
          <td colspan="7">No hay árbitros registrados.</td>
        </tr>
      </tbody>
    </table>
  </main>

  
  <div th:replace="fragments/footer :: footer"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
